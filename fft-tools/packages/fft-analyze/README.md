# FFT Analyze

## Overview

`fft-analyze` is the statistical analysis and visualization component of the toolkit. It takes the polar spectra generated by `fft-polar` and computes summary statistics to characterize the surface roughness and anisotropy.

It offers different modes of analysis to collapse the 2D polar spectrum into 1D profiles, making it easier to interpret the relationship between scale (wavelength) and power (roughness).

## Features

- **Analysis Modes:**
  - **Radial Mean:** Averages power across all angles for each wavenumber bin. Produces a 1D Power vs. Wavelength profile.
  - **Angular Mean:** Averages power across all wavenumbers for each angular bin. Produces a 1D Power vs. Angle (Direction) profile.
- **Aggregation:** Computes the global mean across all processed blocks to provide a dataset-wide summary.
- **Visualization:** Generates interactive HTML plots (using Plotly) or static SVG plots.
- **CSV Export:** detailed numerical results for further processing in Python or R.

## Usage

### Command Line Arguments

```bash
fft-analyze [OPTIONS] --input <DIR> --output <FILE> --mode <MODE>
```

#### Required Arguments
- `--input <DIR>`: Directory containing `fft_polar_block_*.tif` files.
- `--output <FILE>`: Path to the output CSV summary file.
- `--mode <MODE>`: The analysis mode. Choices: `radial-mean`, `angular-mean`.

#### Optional Arguments
- `--plot <FILE>`: Path to save the visualization plot (e.g., `plot.html`).
- `--wavelength-bounds <MIN,MAX>`: Comma-separated range of wavelengths to include in the analysis (e.g., `50,500`).
- `--angle-bounds <MIN,MAX>`: Comma-separated range of angles to include.
- `--save-partials`: Save summary statistics for each individual block in addition to the global average. Default is `false`.
- `--detrend <ORDER>`: Polynomial order for detrending the radial profile (only applicable in `radial-mean` mode). Default is `None`.
- `--jobs <NUM>`: Number of parallel jobs to run. Defaults to 0 (all available cores).

### Example

Generate a radial power spectrum summary and an interactive plot:

```bash
fft-analyze --input ./results/polar \
    --output ./results/radial_summary.csv \
    --plot ./results/radial_plot.html \
    --mode radial-mean
```

## Output

1.  **CSV File:** A table with columns for the independent variable (Wavelength or Angle) and the dependent variable (Mean Power), along with standard deviations.
2.  **Plot File:** An interactive HTML file (or static SVG) visualizing the data.

## Analyzing the Output

### Radial Mean (Power vs. Wavelength)
- **Slope of the Profile:** In log-log space, the slope of the PSD profile is related to the fractal dimension of the surface. A steeper slope indicates a smoother surface at small scales.
- **Power Peaks:** Peaks in the profile represent characteristic scales of the topography. For example, a peak at 200m might correspond to the average spacing of ridge-and-valley systems.
- **Noise Floor:** At very short wavelengths (right side), the profile may flatten, indicating the resolution limit of the DEM or the presence of white noise.

### Angular Mean (Power vs. Angle)
- **Rose Plot / Angular Profile:** Peaks in the angular distribution indicate the dominant orientation of landforms.
- **Anisotropy Ratio:** The ratio between the maximum and minimum power across angles quantifies the strength of directional preference in the terrain.
- **Orientation:** Note that the angles are in the frequency domain. A peak at 90Â° (North-South in frequency) corresponds to East-West striking features in the spatial domain.

### Subsetting (Bounds)
Using `--wavelength-bounds` or `--angle-bounds` allows you to isolate specific processes. For example, by filtering for short wavelengths, you can analyze the orientation of small-scale ripples or glacial flutings without interference from large-scale valley trends.
