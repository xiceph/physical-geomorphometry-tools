# FFT Polar

## Overview

`fft-polar` transforms the 2D Cartesian Power Spectral Density (PSD) maps generated by `fft-process` into a polar representation. This transformation is a crucial step for isotropic analysis, allowing spectral energy to be aggregated by direction (azimuth) and scale (wavelength/wavenumber).

A key feature of this tool is its **physically correct transformation**: it uses a Jacobian-weighted area correction to ensure that the total power is conserved during the transformation from the Cartesian grid (fx, fy) to the Polar grid (r, theta).

## Features

- **Conservation of Energy:** Implements area-weighted integration to account for the varying area of polar bins in the Cartesian frequency domain.
- **Configurable Resolution:** Allows specifying the number of angular (directional) and radial (wavelength) bins.
- **Parallel Processing:** Processes multiple block outputs concurrently.
- **GeoTIFF Output:** Saves the polar spectra as GeoTIFFs for easy inspection in GIS software.

## Usage

### Command Line Arguments

```bash
fft-polar [OPTIONS] --input <DIR> --output <DIR>
```

#### Required Arguments
- `--input <DIR>`: Directory containing the output from `fft-process` (specifically `fft_psd_block_*.tif` files).
- `--output <DIR>`: Directory where the polar results will be saved.

#### Optional Arguments
- `--n-angles <NUM>`: Number of angular bins (0 to 180 degrees). Default is `36`.
- `--n-wavenumbers <NUM>`: Number of radial (wavenumber) bins. Default is `64`.
- `--jobs <NUM>`: Number of parallel jobs to run. Defaults to 0 (all available cores).

### Example

Convert processed FFT blocks to polar spectra with 10-degree angular resolution (18 bins) and 100 radial bins:

```bash
fft-polar --input ./results/fft --output ./results/polar \
    --n-angles 18 --n-wavenumbers 100
```

## Output

For each input block, the tool generates:

1.  **`fft_polar_block_ROW_COL.tif`**: The polar PSD.
    -   **X-axis (Horizontal):** Angular bins (Direction/Azimuth, 0 to 180 degrees).
    -   **Y-axis (Vertical):** Wavelength bins (Scale). The axis is oriented such that wavelengths **increase towards the top** (Long wavelengths at the top, short at the bottom).
2.  **`fft_polar_metadata_block_ROW_COL.json`**: Metadata containing the specific wavelength and angle values for the bin centers, allowing for accurate plotting and analysis.

## Analyzing the Output

### Directional Power (X-axis: Angles)
The horizontal axis represents the orientation of topographic features (azimuth, 0 to 180 degrees).
- **Isotropic Terrain:** Power is evenly distributed across the X-axis (no dominant directionality).
- **Anisotropic Terrain:** Concentration of power in specific angular bins indicates directional landforms (e.g., parallel ridges, glacial flutings).
- **Interpretation Note:** A landform oriented at an angle $\theta$ in the spatial domain produces power at an angle $\theta + 90^\circ$ in the frequency domain (the direction of maximum change).

### Scale Power (Y-axis: Wavelengths)
The vertical axis represents the radial component (wavelength), with values increasing towards the top.
- **Top (Long Wavelengths):** Represent large-scale features such as major hills, valley systems, or broad tectonic trends.
- **Bottom (Short Wavelengths):** Represent small-scale surface roughness, vegetation noise, or DEM artifacts.
- A horizontal "stripe" in the polar plot indicates a dominant characteristic scale present across multiple directions.

### Jacobian Correction
The use of area-weighted normalization is critical. Without it, bins at higher frequencies (shorter wavelengths at the bottom) would appear artificially powerful simply because they cover a larger area in the Cartesian frequency plane. `fft-polar` ensures that the power density remains physically meaningful across all scales.
